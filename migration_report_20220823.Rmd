---
title: "migration report"
author: "Euan A Young"
date: '2022-08-23'
output: html_document
---


# Background

The reviewers wished me to be more clear about the migration in the region. For example, in each parish (Linthal and Elm) how common is it for people to leave the region. For this I have used the previously calculated "migration status" and arrival and departure years (i.e. when an individual was physically present in a population or not). 

### Summary of estimation of migration status and arrival/departure year calculation

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(error =FALSE)
knitr::opts_chunk$set(message = F)
  knitr::opts_chunk$set(warning = F)
    knitr::opts_chunk$set(fig.width = 10)
    knitr::opts_chunk$set(fig.height = 6)
# fig.height 7 plot dimensions in inches
# out.width rescales output width, e.g. "75%", "300px"
# collapse FALSE collapse all sources & output into a single block
# comment "##" prefix for each line of results
# child NULL files(s) to knit and then include
# purl TRUE include or exclude a code chunk when
# extracting source code with knitr::purl()
# getwd()

library(ggplot2)
library(tidyr)
library(stringr)
library(knitr)
library(ggpubr)
library(moments)
library(gridExtra)

```

```{r knitr::opts_chunk$set(results=F)}

data_elm_ADYs_20220823 <- read.csv("data_elm_ADYs_20220823.csv")


for(i in 1:(nrow(data_elm_ADYs_20220823))){ # for each individual
  print(i)
  id <- data_elm_ADYs_20220823$IDp[i]  ### get individual
  id_row <- data_elm_ADYs_20220823[data_elm_ADYs_20220823$IDp==id,]
    for(z in 1:nrow(id_row)){
      id_row_z <- id_row[z,]
    arr_year <- id_row_z$arryear
    dep_year <- id_row_z$depyear
    birth_location <- id_row_z$cregcode
    marriage_location <- id_row_z$sregcode
    migrant_status <- id_row_z$migrantstatus
    if(migrant_status=="emigrant") {
    data_elm_ADYs_20220823$migration_status_reg[data_elm_ADYs_20220823$IDp==id] <- paste0(migrant_status,", married in ", marriage_location, sep="") 
    }
  else{if(migrant_status=="resident_returned") {
    data_elm_ADYs_20220823$migration_status_reg[data_elm_ADYs_20220823$IDp==id] <- paste0(migrant_status,", married in ", marriage_location, sep="")
    }
    data_elm_ADYs_20220823$migration_status_reg[data_elm_ADYs_20220823$IDp==id] <- ifelse(migrant_status=="immigrant", paste0(migrant_status, ", born in ", birth_location, sep=""), migrant_status)
  }

    }
}



data_lin_ADYs_20220823 <- read.csv("data_lin_ADYs_20220823.csv")

for(i in 1:(nrow(data_lin_ADYs_20220823))){ # for each individual
  print(i)
  id <- data_lin_ADYs_20220823$IDp[i]  ### get individual
  id_row <- data_lin_ADYs_20220823[data_lin_ADYs_20220823$IDp==id,]
    for(z in 1:nrow(id_row)){
      id_row_z <- id_row[z,]
    arr_year <- id_row_z$arryear
    dep_year <- id_row_z$depyear
    birth_location <- id_row_z$cregcode
    marriage_location <- id_row_z$sregcode
    migrant_status <- id_row_z$migrantstatus
    if(migrant_status=="emigrant") {
    data_lin_ADYs_20220823$migration_status_reg[data_lin_ADYs_20220823$IDp==id] <- paste0(migrant_status,", married in ", marriage_location, sep="") 
    }
  else{if(migrant_status=="resident_returned") {
    data_lin_ADYs_20220823$migration_status_reg[data_lin_ADYs_20220823$IDp==id] <- paste0(migrant_status,", married in ", marriage_location, sep="")
    }
    data_lin_ADYs_20220823$migration_status_reg[data_lin_ADYs_20220823$IDp==id] <- ifelse(migrant_status=="immigrant", paste0(migrant_status, ", born in ", birth_location, sep=""), migrant_status)
  }

    }
}

```

### This followed the following steps:

- We created a dataframe for each parish (Linthal and Elm) of all individuals who had a birth year and were either born or married in that parish (N=`r nrow(data_lin_ADYs_20220823)`, N=`r nrow(data_elm_ADYs_20220823)`)
- Not all of these individuals had a recorded death year (`r 100*sum(is.na(data_lin_ADYs_20220823$dyear))/NROW(data_lin_ADYs_20220823$dyear)`%, `r 100*sum(is.na(data_elm_ADYs_20220823$dyear))/NROW(data_elm_ADYs_20220823$dyear)`%) and as a result we predicted these from the sex-specific median lifespan of the individuals 10-year birth cohort (except for the individuals that fell within the one "sex-specific median lifespan for the 1910-1920 cohort" of the final styudy year (set as 1990) which were expected to still be alive. If indiviudals were not sexed we used the unsexed median.

These predicted lifespans were as follows:
  
```{r}

f01a <- 
  data_lin_ADYs_20220823 %>% 
  dplyr::filter(byear<1921) %>% 
  dplyr::group_by(byear,sex) %>% 
  dplyr::summarise(predicted_lifespan) %>% 
  ggplot(aes(byear,predicted_lifespan,colour=sex))+
  geom_point() +
  ylab("")+
  xlab("")  +
  theme_bw() +
  theme(axis.line = element_line(colour = "black"),
        axis.line.x.bottom = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) +
  theme(axis.text = element_text(colour = "black", size = 16, angle = 90, family = "serif")) +
  theme(legend.position = "none")+
  theme(axis.title.x =  element_text(colour = "black", size = 16, face="plain")) +
  theme(axis.title.y = element_text(colour = "black", size = 16, face="plain", lineheight = 0.5))

f01b <- 
  data_elm_ADYs_20220823 %>% 
  dplyr::filter(byear<1921) %>% 
  dplyr::group_by(byear,sex) %>% 
  dplyr::summarise(predicted_lifespan) %>% 
  ggplot(aes(byear,predicted_lifespan,colour=sex))+
  geom_point() +
  theme_bw() +
  ylab("")+
  xlab("")  +
  theme(axis.line = element_line(colour = "black"),
        axis.line.x.bottom = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) +
  theme(axis.text = element_text(colour = "black", size = 16, angle = 90, family = "serif")) +
  theme(legend.position = "right")+
  theme(axis.title.x =  element_text(colour = "black", size = 16, face="plain")) +
  theme(axis.title.y = element_text(colour = "black", size = 16, face="plain", lineheight = 0.5))

f01 <- ggarrange(f01a,f01b,
                labels = c("Linthal", "Elm"),
                ncol = 2, nrow = 1)

annotate_figure(f01,
                left = text_grob("Predicted lifespan",rot=90,color = "black", size = 16),
                bottom = text_grob("Birth year", color = "black", size = 16)
)
```

- We then estimated physical presence within each parish by estimating when individuals arrived in (arrival year) and left (departure year) each parish. We did this using records of birth and marriage locations (the parish in which this birth or marriage occured, named as cregcode and sregcode). In the simplest case (i.e. individuals who were born and married in the focal parish and were therefore assumed never to have left) these were the birth and death years of an individual. However, there is significant migration in the region as well as individuals who were still alive or died in childhood. With these in mind, I established the following definitions:

Name: definition; assigning of arrival/departure years

- **resident**: born in the population and reproduced in the population therefore cregcode and sregcode both equal the study parish; Birth year/Death year

- **emmigrant**: born in the population but reproduced outside of the population; cregcode equals the study parish, sregcode does not equal the study parish; Birth year/Birth year of first offspring outside of the parish)

- **immigrant**, born outside of the population but reproduced inside of the population; cregcode does not equal the study parish; sregcode equals the study parish; Birth year of first offspring inside of the parish/Death year

- *Died in childhood*, lifespan is less than their sex specific 20-year cohortâ€™s 5th percentile for AFR; Birth year/Death year

- *Incomplete life history*; any individual who born after 1946;	Birth year/Death year

- *Assumed unmarried*; All other individuals assumed to have remained in the parish but not married, i.e. cregcode equal to birth parish but no recorded sregcode; Birth year/death year)

It should be noted that this would likely include individuals that have emigrated but that the destination was just unknown, thus resulting in no recorded marriage location. 

# Descriptive statistics for migrantstatuses

The sample sizes for these classifications were as follows:

### Overall:

```{r}

f02a <- ggplot(data_lin_ADYs_20220823,aes(migrantstatus,fill=migrantstatus))+
  geom_histogram(stat="count") +
  theme_bw() +
  ylab("")+
  xlab("")  +
  theme(axis.line = element_line(colour = "black"),
        axis.line.x.bottom = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) +
  theme(axis.text = element_text(colour = "black", size = 16, angle = 90, family = "serif")) +
  theme(legend.position = "right")+
  theme(axis.title.x =  element_text(colour = "black", size = 16, face="plain")) +
  theme(axis.title.y = element_text(colour = "black", size = 16, face="plain", lineheight = 0.5))


f02b <- ggplot(data_elm_ADYs_20220823,aes(migrantstatus,fill=migrantstatus))+
  geom_histogram(stat="count") +
  theme_bw() +
  ylab("")+
  xlab("")  +
  theme(axis.line = element_line(colour = "black"),
        axis.line.x.bottom = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) +
  theme(axis.text = element_text(colour = "black", size = 16, angle = 90, family = "serif")) +
  theme(legend.position = "right")+
  theme(axis.title.x =  element_text(colour = "black", size = 16, face="plain")) +
  theme(axis.title.y = element_text(colour = "black", size = 16, face="plain", lineheight = 0.5))


f02 <- ggarrange(f02a,f02b,
                labels = c("Linthal", "Elm"),
                ncol = 2, nrow = 1)

annotate_figure(f02,
                left = text_grob("Count",rot=90,color = "black", size = 16),
                bottom = text_grob("Migration status", color = "black", size = 16)
)


```

## Histograms

### Residents 

```{r}

mgs_ds <- data_lin_ADYs_20220823 %>% 
  dplyr::filter(migrantstatus=="resident_married") %>%
  dplyr::summarise(N=dplyr::n(),Median=round(median(presence_duration),2),Var=var(presence_duration),CV=(sd(presence_duration)/mean(presence_duration)*100), Skew=round(skewness(presence_duration),2)) %>% 
  round(1)

row.names(mgs_ds) <- ""

# SF5.ngo.kk <- 
data_lin_ADYs_20220823 %>% 
  dplyr::filter(migrantstatus=="resident_married") %>%
  ggplot(aes(x=presence_duration)) + 
  geom_histogram(breaks=seq(0, max(data_lin_ADYs_20220823$presence_duration, na.rm = T), by=5), 
                 binwidth = 0.7,
                 col="black", 
                 fill="darkgrey") + 
  labs(x="Present in population duration", y="")+
  theme_bw() +
  theme(axis.line = element_line(colour = "black"), 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) +
  theme(axis.text = element_text(colour = "black", size = 8, angle = 0, family = "serif")) +
  theme(legend.position = "right",legend.justification = c(0.01, 1))+
  theme(axis.title.x =  element_text(colour = "black", size = 16, face="plain")) +
  theme(axis.title.y = element_text(colour = "black", size = 16, face="plain", lineheight = 0.5))+ 
  annotation_custom(tableGrob(mgs_ds), xmin=-50, ymin=150)
  
mgs_ds <- data_elm_ADYs_20220823 %>% 
  dplyr::filter(migrantstatus=="resident_married") %>%
  dplyr::summarise(N=dplyr::n(),Median=round(median(presence_duration),2),Var=var(presence_duration),CV=(sd(presence_duration)/mean(presence_duration)*100), Skew=round(skewness(presence_duration),2)) %>% 
  round(1)

row.names(mgs_ds) <- ""

# SF5.ngo.kk <- 
  data_elm_ADYs_20220823 %>% 
  dplyr::filter(migrantstatus=="resident_married") %>%
  ggplot(aes(x=presence_duration)) + 
  geom_histogram(breaks=seq(0, max(data_elm_ADYs_20220823$presence_duration, na.rm = T), by=5), 
                 binwidth = 0.7,
                 col="black", 
                 fill="darkgrey") + 
  labs(x="Present in population duration", y="")+
  theme_bw() +
  theme(axis.line = element_line(colour = "black"), 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) +
  theme(axis.text = element_text(colour = "black", size = 8, angle = 0, family = "serif")) +
  theme(legend.position = "right",legend.justification = c(0.01, 1))+
  theme(axis.title.x =  element_text(colour = "black", size = 16, face="plain")) +
  theme(axis.title.y = element_text(colour = "black", size = 16, face="plain", lineheight = 0.5))+ 
  annotation_custom(tableGrob(mgs_ds), xmin=-50, ymin=150)
```
### died_in_childhoods 

```{r}

mgs_ds <- data_lin_ADYs_20220823 %>% 
  dplyr::filter(migrantstatus=="died_in_childhood") %>%
  dplyr::summarise(N=dplyr::n(),Median=round(median(presence_duration),2),Var=var(presence_duration),CV=(sd(presence_duration)/mean(presence_duration)*100), Skew=round(skewness(presence_duration),2)) %>% 
  round(1)

row.names(mgs_ds) <- ""

# SF5.ngo.kk <- 
data_lin_ADYs_20220823 %>% 
  dplyr::filter(migrantstatus=="died_in_childhood") %>%
  ggplot(aes(x=presence_duration)) + 
  geom_histogram(breaks=seq(0, max(data_lin_ADYs_20220823$presence_duration, na.rm = T), by=5), 
                 binwidth = 0.7,
                 col="black", 
                 fill="darkgrey") + 
  labs(x="Present in population duration", y="")+
  theme_bw() +
  theme(axis.line = element_line(colour = "black"), 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) +
  theme(axis.text = element_text(colour = "black", size = 8, angle = 0, family = "serif")) +
  theme(legend.position = "right",legend.justification = c(0.01, 1))+
  theme(axis.title.x =  element_text(colour = "black", size = 16, face="plain")) +
  theme(axis.title.y = element_text(colour = "black", size = 16, face="plain", lineheight = 0.5))+ 
  annotation_custom(tableGrob(mgs_ds), xmin=0, ymin=150)
  
mgs_ds <- data_elm_ADYs_20220823 %>% 
  dplyr::filter(migrantstatus=="died_in_childhood") %>%
  dplyr::summarise(N=dplyr::n(),Median=round(median(presence_duration),2),Var=var(presence_duration),CV=(sd(presence_duration)/mean(presence_duration)*100), Skew=round(skewness(presence_duration),2)) %>% 
  round(1)

row.names(mgs_ds) <- ""

# SF5.ngo.kk <- 
  data_elm_ADYs_20220823 %>% 
  dplyr::filter(migrantstatus=="died_in_childhood") %>%
  ggplot(aes(x=presence_duration)) + 
  geom_histogram(breaks=seq(0, max(data_elm_ADYs_20220823$presence_duration, na.rm = T), by=5), 
                 binwidth = 0.7,
                 col="black", 
                 fill="darkgrey") + 
  labs(x="Present in population duration", y="")+
  theme_bw() +
  theme(axis.line = element_line(colour = "black"), 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) +
  theme(axis.text = element_text(colour = "black", size = 8, angle = 0, family = "serif")) +
  theme(legend.position = "right",legend.justification = c(0.01, 1))+
  theme(axis.title.x =  element_text(colour = "black", size = 16, face="plain")) +
  theme(axis.title.y = element_text(colour = "black", size = 16, face="plain", lineheight = 0.5))+ 
  annotation_custom(tableGrob(mgs_ds), xmin=0, ymin=150)
```
### Immigrants 

```{r}

mgs_ds <- data_lin_ADYs_20220823 %>% 
  dplyr::filter(migrantstatus=="immigrant") %>%
  dplyr::summarise(N=dplyr::n(),Median=round(median(presence_duration),2),Var=var(presence_duration),CV=(sd(presence_duration)/mean(presence_duration)*100), Skew=round(skewness(presence_duration),2)) %>% 
  round(1)

row.names(mgs_ds) <- ""

# SF5.ngo.kk <- 
data_lin_ADYs_20220823 %>% 
  dplyr::filter(migrantstatus=="immigrant") %>%
  ggplot(aes(x=presence_duration)) + 
  geom_histogram(breaks=seq(0, max(data_lin_ADYs_20220823$presence_duration, na.rm = T), by=5), 
                 binwidth = 0.7,
                 col="black", 
                 fill="darkgrey") + 
  labs(x="Present in population duration", y="")+
  theme_bw() +
  theme(axis.line = element_line(colour = "black"), 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) +
  theme(axis.text = element_text(colour = "black", size = 8, angle = 0, family = "serif")) +
  theme(legend.position = "right",legend.justification = c(0.01, 1))+
  theme(axis.title.x =  element_text(colour = "black", size = 16, face="plain")) +
  theme(axis.title.y = element_text(colour = "black", size = 16, face="plain", lineheight = 0.5))+ 
  annotation_custom(tableGrob(mgs_ds), xmin=-50, ymin=150)
  
mgs_ds <- data_elm_ADYs_20220823 %>% 
  dplyr::filter(migrantstatus=="immigrant") %>%
  dplyr::summarise(N=dplyr::n(),Median=round(median(presence_duration),2),Var=var(presence_duration),CV=(sd(presence_duration)/mean(presence_duration)*100), Skew=round(skewness(presence_duration),2)) %>% 
  round(1)

row.names(mgs_ds) <- ""

# SF5.ngo.kk <- 
  data_elm_ADYs_20220823 %>% 
  dplyr::filter(migrantstatus=="immigrant") %>%
  ggplot(aes(x=presence_duration)) + 
  geom_histogram(breaks=seq(0, max(data_elm_ADYs_20220823$presence_duration, na.rm = T), by=5), 
                 binwidth = 0.7,
                 col="black", 
                 fill="darkgrey") + 
  labs(x="Present in population duration", y="")+
  theme_bw() +
  theme(axis.line = element_line(colour = "black"), 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) +
  theme(axis.text = element_text(colour = "black", size = 8, angle = 0, family = "serif")) +
  theme(legend.position = "right",legend.justification = c(0.01, 1))+
  theme(axis.title.x =  element_text(colour = "black", size = 16, face="plain")) +
  theme(axis.title.y = element_text(colour = "black", size = 16, face="plain", lineheight = 0.5))+ 
  annotation_custom(tableGrob(mgs_ds), xmin=-50, ymin=150)
```

### emigrants 

```{r}

mgs_ds <- data_lin_ADYs_20220823 %>% 
  dplyr::filter(migrantstatus=="emigrant") %>%
  dplyr::summarise(N=dplyr::n(),Median=round(median(presence_duration),2),Var=var(presence_duration),CV=(sd(presence_duration)/mean(presence_duration)*100), Skew=round(skewness(presence_duration),2)) %>% 
  round(1)

row.names(mgs_ds) <- ""

# SF5.ngo.kk <- 
data_lin_ADYs_20220823 %>% 
  dplyr::filter(migrantstatus=="emigrant") %>%
  ggplot(aes(x=presence_duration)) + 
  geom_histogram(breaks=seq(0, max(data_lin_ADYs_20220823$presence_duration, na.rm = T), by=5), 
                 binwidth = 0.7,
                 col="black", 
                 fill="darkgrey") + 
  labs(x="Present in population duration", y="")+
  theme_bw() +
  theme(axis.line = element_line(colour = "black"), 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) +
  theme(axis.text = element_text(colour = "black", size = 8, angle = 0, family = "serif")) +
  theme(legend.position = "right",legend.justification = c(0.01, 1))+
  theme(axis.title.x =  element_text(colour = "black", size = 16, face="plain")) +
  theme(axis.title.y = element_text(colour = "black", size = 16, face="plain", lineheight = 0.5))+ 
  annotation_custom(tableGrob(mgs_ds), xmin=-50, ymin=150)
  
mgs_ds <- data_elm_ADYs_20220823 %>% 
  dplyr::filter(migrantstatus=="emigrant") %>%
  dplyr::summarise(N=dplyr::n(),Median=round(median(presence_duration),2),Var=var(presence_duration),CV=(sd(presence_duration)/mean(presence_duration)*100), Skew=round(skewness(presence_duration),2)) %>% 
  round(1)

row.names(mgs_ds) <- ""

# SF5.ngo.kk <- 
  data_elm_ADYs_20220823 %>% 
  dplyr::filter(migrantstatus=="emigrant") %>%
  ggplot(aes(x=presence_duration)) + 
  geom_histogram(breaks=seq(0, max(data_elm_ADYs_20220823$presence_duration, na.rm = T), by=5), 
                 binwidth = 0.7,
                 col="black", 
                 fill="darkgrey") + 
  labs(x="Present in population duration", y="")+
  theme_bw() +
  theme(axis.line = element_line(colour = "black"), 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) +
  theme(axis.text = element_text(colour = "black", size = 8, angle = 0, family = "serif")) +
  theme(legend.position = "right",legend.justification = c(0.01, 1))+
  theme(axis.title.x =  element_text(colour = "black", size = 16, face="plain")) +
  theme(axis.title.y = element_text(colour = "black", size = 16, face="plain", lineheight = 0.5))+ 
  annotation_custom(tableGrob(mgs_ds), xmin=-50, ymin=150)
```

### incomplete_life_history

```{r}

mgs_ds <- data_lin_ADYs_20220823 %>% 
  dplyr::filter(migrantstatus=="incomplete_life_history") %>%
  dplyr::summarise(N=dplyr::n(),Median=round(median(presence_duration),2),Var=var(presence_duration),CV=(sd(presence_duration)/mean(presence_duration)*100), Skew=round(skewness(presence_duration),2)) %>% 
  round(1)

row.names(mgs_ds) <- ""

# SF5.ngo.kk <- 
data_lin_ADYs_20220823 %>% 
  dplyr::filter(migrantstatus=="incomplete_life_history") %>%
  ggplot(aes(x=presence_duration)) + 
  geom_histogram(breaks=seq(0, max(data_lin_ADYs_20220823$presence_duration, na.rm = T), by=5), 
                 binwidth = 0.7,
                 col="black", 
                 fill="darkgrey") + 
  labs(x="Present in population duration", y="")+
  theme_bw() +
  theme(axis.line = element_line(colour = "black"), 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) +
  theme(axis.text = element_text(colour = "black", size = 8, angle = 0, family = "serif")) +
  theme(legend.position = "right",legend.justification = c(0.01, 1))+
  theme(axis.title.x =  element_text(colour = "black", size = 16, face="plain")) +
  theme(axis.title.y = element_text(colour = "black", size = 16, face="plain", lineheight = 0.5))+ 
  annotation_custom(tableGrob(mgs_ds), xmin=-50, ymin=150)
  
mgs_ds <- data_elm_ADYs_20220823 %>% 
  dplyr::filter(migrantstatus=="incomplete_life_history") %>%
  dplyr::summarise(N=dplyr::n(),Median=round(median(presence_duration),2),Var=var(presence_duration),CV=(sd(presence_duration)/mean(presence_duration)*100), Skew=round(skewness(presence_duration),2)) %>% 
  round(1)

row.names(mgs_ds) <- ""

# SF5.ngo.kk <- 
  data_elm_ADYs_20220823 %>% 
  dplyr::filter(migrantstatus=="incomplete_life_history") %>%
  ggplot(aes(x=presence_duration)) + 
  geom_histogram(breaks=seq(0, max(data_elm_ADYs_20220823$presence_duration, na.rm = T), by=5), 
                 binwidth = 0.7,
                 col="black", 
                 fill="darkgrey") + 
  labs(x="Present in population duration", y="")+
  theme_bw() +
  theme(axis.line = element_line(colour = "black"), 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) +
  theme(axis.text = element_text(colour = "black", size = 8, angle = 0, family = "serif")) +
  theme(legend.position = "right",legend.justification = c(0.01, 1))+
  theme(axis.title.x =  element_text(colour = "black", size = 16, face="plain")) +
  theme(axis.title.y = element_text(colour = "black", size = 16, face="plain", lineheight = 0.5))+ 
  annotation_custom(tableGrob(mgs_ds), xmin=-50, ymin=150)
```

### assumed_unmarried_residents 

```{r}

mgs_ds <- data_lin_ADYs_20220823 %>% 
  dplyr::filter(migrantstatus=="resident_assumed_unmarried") %>%
  dplyr::summarise(N=dplyr::n(),Median=round(median(presence_duration),2),Var=var(presence_duration),CV=(sd(presence_duration)/mean(presence_duration)*100), Skew=round(skewness(presence_duration),2)) %>% 
  round(1)

row.names(mgs_ds) <- ""

# SF5.ngo.kk <- 
data_lin_ADYs_20220823 %>% 
  dplyr::filter(migrantstatus=="resident_assumed_unmarried") %>%
  ggplot(aes(x=presence_duration)) + 
  geom_histogram(breaks=seq(0, max(data_lin_ADYs_20220823$presence_duration, na.rm = T), by=5), 
                 binwidth = 0.7,
                 col="black", 
                 fill="darkgrey") + 
  labs(x="Present in population duration", y="")+
  theme_bw() +
  theme(axis.line = element_line(colour = "black"), 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) +
  theme(axis.text = element_text(colour = "black", size = 8, angle = 0, family = "serif")) +
  theme(legend.position = "right",legend.justification = c(0.01, 1))+
  theme(axis.title.x =  element_text(colour = "black", size = 16, face="plain")) +
  theme(axis.title.y = element_text(colour = "black", size = 16, face="plain", lineheight = 0.5))+ 
  annotation_custom(tableGrob(mgs_ds), xmin=-50, ymin=150)
  
mgs_ds <- data_elm_ADYs_20220823 %>% 
  dplyr::filter(migrantstatus=="resident_assumed_unmarried") %>%
  dplyr::summarise(N=dplyr::n(),Median=round(median(presence_duration),2),Var=var(presence_duration),CV=(sd(presence_duration)/mean(presence_duration)*100), Skew=round(skewness(presence_duration),2)) %>% 
  round(1)

row.names(mgs_ds) <- ""

# SF5.ngo.kk <- 
  data_elm_ADYs_20220823 %>% 
  dplyr::filter(migrantstatus=="resident_assumed_unmarried") %>%
  ggplot(aes(x=presence_duration)) + 
  geom_histogram(breaks=seq(0, max(data_elm_ADYs_20220823$presence_duration, na.rm = T), by=5), 
                 binwidth = 0.7,
                 col="black", 
                 fill="darkgrey") + 
  labs(x="Present in population duration", y="")+
  theme_bw() +
  theme(axis.line = element_line(colour = "black"), 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) +
  theme(axis.text = element_text(colour = "black", size = 8, angle = 0, family = "serif")) +
  theme(legend.position = "right",legend.justification = c(0.01, 1))+
  theme(axis.title.x =  element_text(colour = "black", size = 16, face="plain")) +
  theme(axis.title.y = element_text(colour = "black", size = 16, face="plain", lineheight = 0.5))+ 
  annotation_custom(tableGrob(mgs_ds), xmin=-50, ymin=150)
```
### assumed_unmarried_residents 

```{r}

mgs_ds <- data_lin_ADYs_20220823 %>% 
  dplyr::filter(migrantstatus=="resident_returned") %>%
  dplyr::summarise(N=dplyr::n(),Median=round(median(presence_duration),2),Var=var(presence_duration),CV=(sd(presence_duration)/mean(presence_duration)*100), Skew=round(skewness(presence_duration),2)) %>% 
  round(1)

row.names(mgs_ds) <- ""

# SF5.ngo.kk <- 
data_lin_ADYs_20220823 %>% 
  dplyr::filter(migrantstatus=="resident_returned") %>%
  ggplot(aes(x=presence_duration)) + 
  geom_histogram(breaks=seq(0, max(data_lin_ADYs_20220823$presence_duration, na.rm = T), by=5), 
                 binwidth = 0.7,
                 col="black", 
                 fill="darkgrey") + 
  labs(x="Present in population duration", y="")+
  theme_bw() +
  theme(axis.line = element_line(colour = "black"), 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) +
  theme(axis.text = element_text(colour = "black", size = 8, angle = 0, family = "serif")) +
  theme(legend.position = "right",legend.justification = c(0.01, 1))+
  theme(axis.title.x =  element_text(colour = "black", size = 16, face="plain")) +
  theme(axis.title.y = element_text(colour = "black", size = 16, face="plain", lineheight = 0.5))+ 
  annotation_custom(tableGrob(mgs_ds), xmin=-50, ymin=150)
  
mgs_ds <- data_elm_ADYs_20220823 %>% 
  dplyr::filter(migrantstatus=="resident_returned") %>%
  dplyr::summarise(N=dplyr::n(),Median=round(median(presence_duration),2),Var=var(presence_duration),CV=(sd(presence_duration)/mean(presence_duration)*100), Skew=round(skewness(presence_duration),2)) %>% 
  round(1)

row.names(mgs_ds) <- ""

# SF5.ngo.kk <- 
  data_elm_ADYs_20220823 %>% 
  dplyr::filter(migrantstatus=="resident_returned") %>%
  ggplot(aes(x=presence_duration)) + 
  geom_histogram(breaks=seq(0, max(data_elm_ADYs_20220823$presence_duration, na.rm = T), by=5), 
                 binwidth = 0.7,
                 col="black", 
                 fill="darkgrey") + 
  labs(x="Present in population duration", y="")+
  theme_bw() +
  theme(axis.line = element_line(colour = "black"), 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) +
  theme(axis.text = element_text(colour = "black", size = 8, angle = 0, family = "serif")) +
  theme(legend.position = "right",legend.justification = c(0.01, 1))+
  theme(axis.title.x =  element_text(colour = "black", size = 16, face="plain")) +
  theme(axis.title.y = element_text(colour = "black", size = 16, face="plain", lineheight = 0.5))+ 
  annotation_custom(tableGrob(mgs_ds), xmin=-50, ymin=150)
```

## Migration status sample sizes 

Here we count the migrations statuses 

### Overall

```{r}
data_lin_ADYs_20220823 <- data_lin_ADYs_20220823  %>%
  dplyr::mutate(mut.migration_status_reg=stringr::str_replace_all(migration_status_reg,'resident_assumed_unmarried','Resident (no marriage record)')) %>%
  dplyr::mutate(mut.migration_status_reg=stringr::str_replace_all(mut.migration_status_reg,'immigrant, born in GL03','Immigrant (from Elm parish)')) %>%
  dplyr::mutate(mut.migration_status_reg=stringr::str_replace_all(mut.migration_status_reg,'immigrant, born in NA','Immigrant (from outside Glarus)')) %>%
  dplyr::mutate(mut.migration_status_reg=stringr::str_replace_all(mut.migration_status_reg,'immigrant, born in GL','Immigrant (from other Glarus parish)')) %>%
  dplyr::mutate(mut.migration_status_reg=stringr::str_replace_all(mut.migration_status_reg,'emigrant, married in GL03','Emigrant (to Elm)')) %>%
  dplyr::mutate(mut.migration_status_reg=stringr::str_replace_all(mut.migration_status_reg,'emigrant, married in GL','Emigrant (to other Glarus parish)')) %>%
  dplyr::mutate(mut.migration_status_reg=stringr::str_replace_all(mut.migration_status_reg,'emigrant_assumed_to_outside_glarus','Emigrant (to outside Glarus)')) %>%
  dplyr::mutate(mut.migration_status_reg=stringr::str_replace_all(mut.migration_status_reg,'resident_returned','Resident (returned)')) %>%
  dplyr::mutate(mut.migration_status_reg=stringr::str_replace_all(mut.migration_status_reg,'resident_assumed_unmarried','Resident (unmarried)')) %>%
    dplyr::mutate(mut.migration_status_reg=stringr::str_replace_all(mut.migration_status_reg,'resident_married','Resident (married)')) %>%
  dplyr::mutate(mut.migration_status_reg=stringr::str_replace_all(mut.migration_status_reg,'incomplete_life_history','Incomplete life history')) %>%
  dplyr::mutate(mut.migration_status_reg=stringr::str_replace_all(mut.migration_status_reg,'died_in_childhood','Died during childhood')) %>%
  dplyr::mutate(mut.migration_status_reg=stringr::str_replace_all(mut.migration_status_reg,'[0123456789]','')) %>%
  dplyr::mutate(`migration status`= mut.migration_status_reg) %>% 
  dplyr::select(-mut.migration_status_reg)

data_elm_ADYs_20220823 <- data_elm_ADYs_20220823  %>%  
   dplyr::mutate(mut.migration_status_reg=stringr::str_replace_all(migration_status_reg,'assumed_immigrant','Resident (no marriage record)')) %>%  
   dplyr::mutate(mut.migration_status_reg=stringr::str_replace_all(mut.migration_status_reg,'immigrant, born in GL09','Immigrant (from Linthal parish)')) %>%  
   dplyr::mutate(mut.migration_status_reg=stringr::str_replace_all(mut.migration_status_reg,'immigrant, born in NA','Immigrant (from outside Glarus)')) %>%  
   dplyr::mutate(mut.migration_status_reg=stringr::str_replace_all(mut.migration_status_reg,'immigrant, born in GL','Immigrant (from other Glarus parish)')) %>%  
   dplyr::mutate(mut.migration_status_reg=stringr::str_replace_all(mut.migration_status_reg,'emigrant, married in GL09','Emigrant (to Linthal)')) %>% 
  dplyr::mutate(mut.migration_status_reg=stringr::str_replace_all(mut.migration_status_reg,'emigrant, married in GL','Emigrant (to other Glarus parish)')) %>%
  dplyr::mutate(mut.migration_status_reg=stringr::str_replace_all(mut.migration_status_reg,'emigrant_assumed_to_outside_glarus','Emigrant (to outside Glarus)')) %>%
   dplyr::mutate(mut.migration_status_reg=stringr::str_replace_all(mut.migration_status_reg,'resident_returned','Resident (returned)')) %>%
  dplyr::mutate(mut.migration_status_reg=stringr::str_replace_all(mut.migration_status_reg,'resident_assumed_unmarried','Resident (unmarried)')) %>%
   dplyr::mutate(mut.migration_status_reg=stringr::str_replace_all(mut.migration_status_reg,'resident_married','Resident (married)')) %>%  
   dplyr::mutate(mut.migration_status_reg=stringr::str_replace_all(mut.migration_status_reg,'incomplete_life_history','Incomplete life history')) %>%  
   dplyr::mutate(mut.migration_status_reg=stringr::str_replace_all(mut.migration_status_reg,'died_in_childhood','Died during childhood')) %>%  
   dplyr::mutate(mut.migration_status_reg=stringr::str_replace_all(mut.migration_status_reg,'[0123456789]','')) %>%  
   dplyr::mutate(`migration status`= mut.migration_status_reg) %>%
  dplyr::select(-mut.migration_status_reg)

f03a <- ggplot(data_lin_ADYs_20220823,aes(`migration status`,fill=`migration status`))+
  geom_histogram(stat="count") +
  theme_bw() +
  ylab("")+
  xlab("")  +
  theme(axis.line = element_line(colour = "black"),
        axis.line.x.bottom = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) +
  theme(axis.text = element_text(colour = "black", size = 16, angle = 90, family = "serif")) +
  theme(legend.position = "none")+
  theme(axis.title.x =  element_text(colour = "black", size = 16, face="plain")) +
  theme(axis.title.y = element_text(colour = "black", size = 16, face="plain", lineheight = 0.5))


f03b <- ggplot(data_elm_ADYs_20220823,aes(`migration status`,fill=`migration status`))+
  geom_histogram(stat="count") +
  theme_bw() +
  ylab("")+
  xlab("")  +
  theme(axis.line = element_line(colour = "black"),
        axis.line.x.bottom = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) +
  theme(axis.text = element_text(colour = "black", size = 16, angle = 90, family = "serif")) +
  theme(legend.position = "none")+
  theme(axis.title.x =  element_text(colour = "black", size = 16, face="plain")) +
  theme(axis.title.y = element_text(colour = "black", size = 16, face="plain", lineheight = 0.5))


f03 <- ggarrange(f03a,f03b,
                labels = c("Linthal", "Elm"),
                ncol = 2, nrow = 1)

annotate_figure(f03,
                left = text_grob("Count",rot=90,color = "black", size = 16),
                bottom = text_grob("Migration status", color = "black", size = 16)
)

```

### In 1990

```{r}

f05a <-  data_lin_ADYs_20220823 %>% 
  dplyr::filter((1990+1)>arryear & (1990-1) < depyear) %>% 
  ggplot(aes(`migration status`,fill=`migration status`))+
  geom_histogram(stat="count") +
  theme_bw() +
  ylab("")+
  xlab("")  +
  theme(axis.line = element_line(colour = "black"),
        axis.line.x.bottom = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) +
  theme(axis.text = element_text(colour = "black", size = 16, angle = 90, family = "serif")) +
  theme(legend.position = "none")+
  theme(axis.title.x =  element_text(colour = "black", size = 16, face="plain")) +
  theme(axis.title.y = element_text(colour = "black", size = 16, face="plain", lineheight = 0.5))


f05b <- data_elm_ADYs_20220823 %>% 
  dplyr::filter((1990+1)>arryear & (1990-1) < depyear) %>% 
  ggplot(aes(`migration status`,fill=`migration status`))+
  geom_histogram(stat="count") +
  theme_bw() +
  ylab("")+
  xlab("")  +
  theme(axis.line = element_line(colour = "black"),
        axis.line.x.bottom = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) +
  theme(axis.text = element_text(colour = "black", size = 16, angle = 90, family = "serif")) +
  theme(legend.position = "none")+
  theme(axis.title.x =  element_text(colour = "black", size = 16, face="plain")) +
  theme(axis.title.y = element_text(colour = "black", size = 16, face="plain", lineheight = 0.5))


f05 <- ggarrange(f05a,f05b,
                labels = c("Linthal", "Elm"),
                ncol = 2, nrow = 1)

annotate_figure(f05,
                left = text_grob("Count",rot=90,color = "black", size = 16),
                bottom = text_grob("Migration status", color = "black", size = 16)
)

```


# Migration Statuses through time

```{r}
elm_pop_20220824 <- as.data.frame(t(read.csv("elm_pop_20220824.csv")))

colnames(elm_pop_20220824) <- elm_pop_20220824[rownames(elm_pop_20220824)=="X",]

elm_pop_20220824 <- elm_pop_20220824[!rownames(elm_pop_20220824)=="X",]

elm_pop_20220824$ID <- rownames(elm_pop_20220824)

elm_mig_popn <- elm_pop_20220824 %>%
  tidyr::gather(ID)

elm_mig_popn <- elm_mig_popn  %>%
    dplyr::mutate(mut.value=stringr::str_replace_all(value,'assumed_immigrant','Resident (no marriage record)')) %>%  
   dplyr::mutate(mut.value=stringr::str_replace_all(mut.value,'immigrant, born in GL09','Immigrant (from Linthal parish)')) %>%  
   dplyr::mutate(mut.value=stringr::str_replace_all(mut.value,'immigrant, born in NA','Immigrant (from outside Glarus)')) %>%  
   dplyr::mutate(mut.value=stringr::str_replace_all(mut.value,'immigrant, born in GL','Immigrant (from other Glarus parish)')) %>%  
   dplyr::mutate(mut.value=stringr::str_replace_all(mut.value,'emigrant, married in GL09','Emigrant (to Linthal)')) %>% 
  dplyr::mutate(mut.value=stringr::str_replace_all(mut.value,'emigrant, married in GL','Emigrant (to other Glarus parish)')) %>%
  dplyr::mutate(mut.value=stringr::str_replace_all(mut.value,'emigrant_assumed_to_outside_glarus','Emigrant (to outside Glarus)')) %>%
   dplyr::mutate(mut.value=stringr::str_replace_all(mut.value,'resident_returned','Resident (returned)')) %>%
  dplyr::mutate(mut.value=stringr::str_replace_all(mut.value,'resident_assumed_unmarried','Resident (unmarried)')) %>%
   dplyr::mutate(mut.value=stringr::str_replace_all(mut.value,'resident_married','Resident (married)')) %>%  
   dplyr::mutate(mut.value=stringr::str_replace_all(mut.value,'incomplete_life_history','Incomplete life history')) %>%  
   dplyr::mutate(mut.value=stringr::str_replace_all(mut.value,'died_in_childhood','Died during childhood')) %>%  
   dplyr::mutate(mut.value=stringr::str_replace_all(mut.value,'[0123456789]','')) %>%  
  dplyr::mutate(`migration status`= mut.value)

lin_pop_20220824 <- as.data.frame(t(read.csv("lin_pop_20220824.csv")))

colnames(lin_pop_20220824) <- lin_pop_20220824[rownames(lin_pop_20220824)=="X",]

lin_pop_20220824 <- lin_pop_20220824[!rownames(lin_pop_20220824)=="X",]

lin_pop_20220824$ID <- rownames(lin_pop_20220824)

lin_mig_popn <- lin_pop_20220824 %>%
  tidyr::gather(ID)

lin_mig_popn <- lin_mig_popn  %>%
    dplyr::mutate(mut.value=stringr::str_replace_all(value,'resident_assumed_unmarried','Resident (no marriage record)')) %>%
  dplyr::mutate(mut.value=stringr::str_replace_all(mut.value,'immigrant, born in GL03','Immigrant (from Elm parish)')) %>%
  dplyr::mutate(mut.value=stringr::str_replace_all(mut.value,'immigrant, born in NA','Immigrant (from outside Glarus)')) %>%
  dplyr::mutate(mut.value=stringr::str_replace_all(mut.value,'immigrant, born in GL','Immigrant (from other Glarus parish)')) %>%
  dplyr::mutate(mut.value=stringr::str_replace_all(mut.value,'emigrant, married in GL03','Emigrant (to Elm)')) %>%
  dplyr::mutate(mut.value=stringr::str_replace_all(mut.value,'emigrant, married in GL','Emigrant (to other Glarus parish)')) %>%
  dplyr::mutate(mut.value=stringr::str_replace_all(mut.value,'emigrant_assumed_to_outside_glarus','Emigrant (to outside Glarus)')) %>%
  dplyr::mutate(mut.value=stringr::str_replace_all(mut.value,'resident_returned','Resident (returned)')) %>%
  dplyr::mutate(mut.value=stringr::str_replace_all(mut.value,'resident_assumed_unmarried','Resident (unmarried)')) %>%
    dplyr::mutate(mut.value=stringr::str_replace_all(mut.value,'resident_married','Resident (married)')) %>%
  dplyr::mutate(mut.value=stringr::str_replace_all(mut.value,'incomplete_life_history','Incomplete life history')) %>%
  dplyr::mutate(mut.value=stringr::str_replace_all(mut.value,'died_in_childhood','Died during childhood')) %>%
  dplyr::mutate(mut.value=stringr::str_replace_all(mut.value,'[0123456789]','')) %>%
  dplyr::mutate(`migration status`= mut.value)


f07a <- lin_mig_popn %>%
  dplyr::count(ID,`migration status`) %>%
  dplyr::mutate(year=as.numeric(ID)) %>%
  dplyr::mutate(n=as.numeric(n)) %>%
  dplyr::mutate(`migration status`=as.character(`migration status`)) %>%
  tidyr::drop_na(`migration status`) %>%
  dplyr::select(year,`migration status`,n) %>%
   ggplot(aes(fill=`migration status`, y=n,x=year)) +
  geom_bar(position="stack", stat="identity") +
  ylab("N")+
  xlab(bquote('Year'))  +
  ylim(0,4500) +
  theme_bw() +
  theme(axis.line = element_line(colour = "black"),
        axis.line.x.bottom = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) +
  theme(axis.text = element_text(colour = "black", size = 16, angle = 0, family = "serif")) +
  theme(legend.position = "right")+
  theme(axis.title.x =  element_text(colour = "black", size = 16, face="plain")) +
  theme(axis.title.y = element_text(colour = "black", size = 16, face="plain", lineheight = 0.5))

f07b <- elm_mig_popn %>%
  dplyr::count(ID,`migration status`) %>%
  dplyr::mutate(year=as.numeric(ID)) %>%
  dplyr::mutate(n=as.numeric(n)) %>%
  dplyr::mutate(`migration status`=as.character(`migration status`)) %>%
  tidyr::drop_na(`migration status`) %>%
  dplyr::select(year,`migration status`,n) %>%
   ggplot(aes(fill=`migration status`, y=n,x=year)) +
  geom_bar(position="stack", stat="identity") +
  ylab("N")+
  xlab(bquote('Year'))  +
  ylim(0,4500) +
  theme_bw() +
  theme(axis.line = element_line(colour = "black"),
        axis.line.x.bottom = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) +
  theme(axis.text = element_text(colour = "black", size = 16, angle = 0, family = "serif")) +
  theme(legend.position = "right")+
  theme(axis.title.x =  element_text(colour = "black", size = 16, face="plain")) +
  theme(axis.title.y = element_text(colour = "black", size = 16, face="plain", lineheight = 0.5))

f07 <- ggarrange(f07a,f07b,
                labels = c("Linthal", "Elm"),
                ncol = 1, nrow = 2)

pdf(file = "migration_status_overtime.pdf", height = 10, width = 14)
annotate_figure(f07,
                left = text_grob("Count",rot=90,color = "black", size = 16),
                bottom = text_grob("Year", color = "black", size = 16))
                
```

```{r}
lin_mig_popn %>%
  dplyr::count(ID,`migration status`) %>%
  dplyr::mutate(year=as.numeric(ID)) %>%
  dplyr::mutate(n=as.numeric(n)) %>%
  dplyr::mutate(`migration status`=as.character(`migration status`)) %>%
  tidyr::drop_na(`migration status`) %>%
  dplyr::select(year,`migration status`,n) %>%
   ggplot(aes(fill=`migration status`, y=n,x=year)) +
  geom_bar(position="stack", stat="identity") +
  facet_wrap(~`migration status`) +
  ylab("N")+
  xlab(bquote('Year'))  +
  theme_bw() +
  theme(axis.line = element_line(colour = "black"),
        axis.line.x.bottom = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) +
  theme(axis.text = element_text(colour = "black", size = 16, angle = 0, family = "serif")) +
  theme(legend.position = "right")+
  theme(axis.title.x =  element_text(colour = "black", size = 16, face="plain")) +
  theme(axis.title.y = element_text(colour = "black", size = 16, face="plain", lineheight = 0.5))

elm_mig_popn %>%
  dplyr::count(ID,`migration status`) %>%
  dplyr::mutate(year=as.numeric(ID)) %>%
  dplyr::mutate(n=as.numeric(n)) %>%
  dplyr::mutate(`migration status`=as.character(`migration status`)) %>%
  tidyr::drop_na(`migration status`) %>%
  dplyr::select(year,`migration status`,n) %>%
  ggplot(aes(fill=`migration status`, y=n,x=year)) +
  geom_bar(position="stack", stat="identity") +
  facet_wrap(~`migration status`) +
  ylab("N")+
  xlab(bquote('Year'))  +
  theme_bw() +
  theme(axis.line = element_line(colour = "black"),
        axis.line.x.bottom = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) +
  theme(axis.text = element_text(colour = "black", size = 16, angle = 0, family = "serif")) +
  theme(legend.position = "right")+
  theme(axis.title.x =  element_text(colour = "black", size = 16, face="plain")) +
  theme(axis.title.y = element_text(colour = "black", size = 16, face="plain", lineheight = 0.5))


```
```{r}

lin_mig_popn %>%
  dplyr::count(ID,`migration status`) %>%
  dplyr::mutate(year=as.numeric(ID)) %>%
  dplyr::mutate(n=as.numeric(n)) %>%
  dplyr::mutate(`migration status`=as.character(`migration status`)) %>%
  tidyr::drop_na(`migration status`) %>%
  dplyr::select(year,`migration status`,n) %>%
   ggplot(aes(fill=`migration status`, y=n,x=year)) +
  geom_bar(position="stack", stat="identity") +
  facet_wrap(~`migration status`, scales = "free") +
  ylab("N")+
  xlab(bquote('Year'))  +
  theme_bw() +
  theme(axis.line = element_line(colour = "black"),
        axis.line.x.bottom = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) +
  theme(axis.text = element_text(colour = "black", size = 16, angle = 0, family = "serif")) +
  theme(legend.position = "right")+
  theme(axis.title.x =  element_text(colour = "black", size = 16, face="plain")) +
  theme(axis.title.y = element_text(colour = "black", size = 16, face="plain", lineheight = 0.5))

elm_mig_popn %>%
  dplyr::count(ID,`migration status`) %>%
  dplyr::mutate(year=as.numeric(ID)) %>%
  dplyr::mutate(n=as.numeric(n)) %>%
  dplyr::mutate(`migration status`=as.character(`migration status`)) %>%
  tidyr::drop_na(`migration status`) %>%
  dplyr::select(year,`migration status`,n) %>%
  ggplot(aes(fill=`migration status`, y=n,x=year)) +
  geom_bar(position="stack", stat="identity") +
  facet_wrap(~`migration status`, scales = "free") +
  ylab("N")+
  xlab(bquote('Year'))  +
  theme_bw() +
  theme(axis.line = element_line(colour = "black"),
        axis.line.x.bottom = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) +
  theme(axis.text = element_text(colour = "black", size = 16, angle = 0, family = "serif")) +
  theme(legend.position = "right")+
  theme(axis.title.x =  element_text(colour = "black", size = 16, face="plain")) +
  theme(axis.title.y = element_text(colour = "black", size = 16, face="plain", lineheight = 0.5))


```

